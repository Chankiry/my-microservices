{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"keycloak-angular\";\nimport * as i2 from \"../../services/notification.service\";\nexport class NotificationsComponent {\n  constructor(keycloakService, notificationService) {\n    this.keycloakService = keycloakService;\n    this.notificationService = notificationService;\n    this.notifications = [];\n    this.emailLogs = [];\n    this.loading = true;\n    this.currentPage = 1;\n    this.pageSize = 10;\n    this.totalItems = 0;\n    this.totalPages = 0;\n    this.filterType = 'all';\n    this.selectedNotification = null;\n    this.Math = Math;\n    // Stats\n    this.totalNotifications = 0;\n    this.unreadCount = 0;\n    this.readCount = 0;\n    // Email modal\n    this.showEmailModal = false;\n    this.sendingEmail = false;\n    this.emailForm = {\n      to: '',\n      subject: '',\n      body: ''\n    };\n  }\n  ngOnInit() {\n    this.loadNotifications();\n    this.loadEmailLogs();\n  }\n  loadNotifications() {\n    this.loading = true;\n    const userId = 'admin'; // In real app, get from Keycloak\n    this.notificationService.getNotifications(userId, {\n      unreadOnly: this.filterType === 'unread',\n      page: this.currentPage,\n      limit: +this.pageSize\n    }).subscribe({\n      next: response => {\n        this.notifications = this.filterType === 'read' ? response.data.filter(n => n.isRead) : response.data;\n        this.totalItems = response.pagination.total;\n        this.totalPages = response.pagination.totalPages;\n        this.totalNotifications = response.pagination.total;\n        this.unreadCount = response.data.filter(n => !n.isRead).length;\n        this.readCount = response.data.filter(n => n.isRead).length;\n        this.loading = false;\n      },\n      error: err => {\n        console.error('Failed to load notifications:', err);\n        this.loading = false;\n      }\n    });\n  }\n  loadEmailLogs() {\n    // In a real app, you'd have an endpoint to fetch email logs\n    // For now, we'll use mock data\n    this.emailLogs = [];\n  }\n  markAsRead(id) {\n    this.notificationService.markAsRead(id).subscribe({\n      next: () => {\n        this.loadNotifications();\n      },\n      error: err => {\n        console.error('Failed to mark notification as read:', err);\n        alert('Failed to mark notification as read');\n      }\n    });\n  }\n  markAllAsRead() {\n    const unreadNotifications = this.notifications.filter(n => !n.isRead);\n    if (unreadNotifications.length === 0) return;\n    Promise.all(unreadNotifications.map(n => this.notificationService.markAsRead(n.id).toPromise())).then(() => {\n      this.loadNotifications();\n    }).catch(err => {\n      console.error('Failed to mark all notifications as read:', err);\n      alert('Failed to mark all notifications as read');\n    });\n  }\n  viewDetails(notification) {\n    this.selectedNotification = notification;\n  }\n  openEmailModal() {\n    this.showEmailModal = true;\n    this.emailForm = {\n      to: '',\n      subject: '',\n      body: ''\n    };\n  }\n  closeEmailModal() {\n    this.showEmailModal = false;\n  }\n  sendEmail() {\n    this.sendingEmail = true;\n    this.notificationService.sendEmail({\n      to: this.emailForm.to,\n      subject: this.emailForm.subject,\n      body: this.emailForm.body\n    }).subscribe({\n      next: () => {\n        this.sendingEmail = false;\n        this.closeEmailModal();\n        alert('Email sent successfully!');\n        this.loadEmailLogs();\n      },\n      error: err => {\n        console.error('Failed to send email:', err);\n        this.sendingEmail = false;\n        alert('Failed to send email');\n      }\n    });\n  }\n  goToPage(page) {\n    if (page < 1 || page > this.totalPages) return;\n    this.currentPage = page;\n    this.loadNotifications();\n  }\n  getPageNumbers() {\n    const pages = [];\n    const start = Math.max(1, this.currentPage - 2);\n    const end = Math.min(this.totalPages, this.currentPage + 2);\n    for (let i = start; i <= end; i++) {\n      pages.push(i);\n    }\n    return pages;\n  }\n  getTypeClass(type) {\n    switch (type) {\n      case 'email':\n        return 'bg-blue-100 text-blue-800';\n      case 'sms':\n        return 'bg-green-100 text-green-800';\n      case 'push':\n        return 'bg-purple-100 text-purple-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  }\n  getEmailStatusClass(status) {\n    switch (status) {\n      case 'sent':\n        return 'bg-green-100 text-green-800';\n      case 'failed':\n        return 'bg-red-100 text-red-800';\n      case 'pending':\n        return 'bg-yellow-100 text-yellow-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  }\n  logout() {\n    this.keycloakService.logout();\n  }\n  static {\n    this.ɵfac = function NotificationsComponent_Factory(t) {\n      return new (t || NotificationsComponent)(i0.ɵɵdirectiveInject(i1.KeycloakService), i0.ɵɵdirectiveInject(i2.NotificationService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: NotificationsComponent,\n      selectors: [[\"app-notifications\"]],\n      decls: 1,\n      vars: 0,\n      template: function NotificationsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtext(0, \"template.html\");\n        }\n      },\n      encapsulation: 2\n    });\n  }\n}","map":{"version":3,"names":["NotificationsComponent","constructor","keycloakService","notificationService","notifications","emailLogs","loading","currentPage","pageSize","totalItems","totalPages","filterType","selectedNotification","Math","totalNotifications","unreadCount","readCount","showEmailModal","sendingEmail","emailForm","to","subject","body","ngOnInit","loadNotifications","loadEmailLogs","userId","getNotifications","unreadOnly","page","limit","subscribe","next","response","data","filter","n","isRead","pagination","total","length","error","err","console","markAsRead","id","alert","markAllAsRead","unreadNotifications","Promise","all","map","toPromise","then","catch","viewDetails","notification","openEmailModal","closeEmailModal","sendEmail","goToPage","getPageNumbers","pages","start","max","end","min","i","push","getTypeClass","type","getEmailStatusClass","status","logout","i0","ɵɵdirectiveInject","i1","KeycloakService","i2","NotificationService","selectors","decls","vars","template","NotificationsComponent_Template","rf","ctx","ɵɵtext"],"sources":["D:\\MLMUPC\\new microService\\my-microservices\\frontend\\admin-web\\src\\app\\components\\notifications\\notifications.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { KeycloakService } from 'keycloak-angular';\nimport { NotificationService } from '../../services/notification.service';\nimport { Notification, EmailLog } from '../../models';\n\n@Component({\n  selector: 'app-notifications',\n  template: 'template.html',\n  styles: []\n})\nexport class NotificationsComponent implements OnInit {\n  notifications: Notification[] = [];\n  emailLogs: EmailLog[] = [];\n  loading = true;\n  currentPage = 1;\n  pageSize = 10;\n  totalItems = 0;\n  totalPages = 0;\n  filterType = 'all';\n  selectedNotification: Notification | null = null;\n  Math = Math;\n\n  // Stats\n  totalNotifications = 0;\n  unreadCount = 0;\n  readCount = 0;\n\n  // Email modal\n  showEmailModal = false;\n  sendingEmail = false;\n  emailForm = {\n    to: '',\n    subject: '',\n    body: ''\n  };\n\n  constructor(\n    private keycloakService: KeycloakService,\n    private notificationService: NotificationService\n  ) {}\n\n  ngOnInit() {\n    this.loadNotifications();\n    this.loadEmailLogs();\n  }\n\n  loadNotifications() {\n    this.loading = true;\n    const userId = 'admin'; // In real app, get from Keycloak\n    \n    this.notificationService.getNotifications(userId, {\n      unreadOnly: this.filterType === 'unread',\n      page: this.currentPage,\n      limit: +this.pageSize\n    }).subscribe({\n      next: (response) => {\n        this.notifications = this.filterType === 'read' \n          ? response.data.filter(n => n.isRead)\n          : response.data;\n        this.totalItems = response.pagination.total;\n        this.totalPages = response.pagination.totalPages;\n        this.totalNotifications = response.pagination.total;\n        this.unreadCount = response.data.filter(n => !n.isRead).length;\n        this.readCount = response.data.filter(n => n.isRead).length;\n        this.loading = false;\n      },\n      error: (err) => {\n        console.error('Failed to load notifications:', err);\n        this.loading = false;\n      }\n    });\n  }\n\n  loadEmailLogs() {\n    // In a real app, you'd have an endpoint to fetch email logs\n    // For now, we'll use mock data\n    this.emailLogs = [];\n  }\n\n  markAsRead(id: string) {\n    this.notificationService.markAsRead(id).subscribe({\n      next: () => {\n        this.loadNotifications();\n      },\n      error: (err) => {\n        console.error('Failed to mark notification as read:', err);\n        alert('Failed to mark notification as read');\n      }\n    });\n  }\n\n  markAllAsRead() {\n    const unreadNotifications = this.notifications.filter(n => !n.isRead);\n    if (unreadNotifications.length === 0) return;\n\n    Promise.all(unreadNotifications.map(n => \n      this.notificationService.markAsRead(n.id).toPromise()\n    )).then(() => {\n      this.loadNotifications();\n    }).catch((err) => {\n      console.error('Failed to mark all notifications as read:', err);\n      alert('Failed to mark all notifications as read');\n    });\n  }\n\n  viewDetails(notification: Notification) {\n    this.selectedNotification = notification;\n  }\n\n  openEmailModal() {\n    this.showEmailModal = true;\n    this.emailForm = { to: '', subject: '', body: '' };\n  }\n\n  closeEmailModal() {\n    this.showEmailModal = false;\n  }\n\n  sendEmail() {\n    this.sendingEmail = true;\n    this.notificationService.sendEmail({\n      to: this.emailForm.to,\n      subject: this.emailForm.subject,\n      body: this.emailForm.body\n    }).subscribe({\n      next: () => {\n        this.sendingEmail = false;\n        this.closeEmailModal();\n        alert('Email sent successfully!');\n        this.loadEmailLogs();\n      },\n      error: (err) => {\n        console.error('Failed to send email:', err);\n        this.sendingEmail = false;\n        alert('Failed to send email');\n      }\n    });\n  }\n\n  goToPage(page: number) {\n    if (page < 1 || page > this.totalPages) return;\n    this.currentPage = page;\n    this.loadNotifications();\n  }\n\n  getPageNumbers(): number[] {\n    const pages: number[] = [];\n    const start = Math.max(1, this.currentPage - 2);\n    const end = Math.min(this.totalPages, this.currentPage + 2);\n    for (let i = start; i <= end; i++) {\n      pages.push(i);\n    }\n    return pages;\n  }\n\n  getTypeClass(type: string): string {\n    switch (type) {\n      case 'email': return 'bg-blue-100 text-blue-800';\n      case 'sms': return 'bg-green-100 text-green-800';\n      case 'push': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  }\n\n  getEmailStatusClass(status: string): string {\n    switch (status) {\n      case 'sent': return 'bg-green-100 text-green-800';\n      case 'failed': return 'bg-red-100 text-red-800';\n      case 'pending': return 'bg-yellow-100 text-yellow-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  }\n\n  logout() {\n    this.keycloakService.logout();\n  }\n}\n"],"mappings":";;;AAUA,OAAM,MAAOA,sBAAsB;EA0BjCC,YACUC,eAAgC,EAChCC,mBAAwC;IADxC,KAAAD,eAAe,GAAfA,eAAe;IACf,KAAAC,mBAAmB,GAAnBA,mBAAmB;IA3B7B,KAAAC,aAAa,GAAmB,EAAE;IAClC,KAAAC,SAAS,GAAe,EAAE;IAC1B,KAAAC,OAAO,GAAG,IAAI;IACd,KAAAC,WAAW,GAAG,CAAC;IACf,KAAAC,QAAQ,GAAG,EAAE;IACb,KAAAC,UAAU,GAAG,CAAC;IACd,KAAAC,UAAU,GAAG,CAAC;IACd,KAAAC,UAAU,GAAG,KAAK;IAClB,KAAAC,oBAAoB,GAAwB,IAAI;IAChD,KAAAC,IAAI,GAAGA,IAAI;IAEX;IACA,KAAAC,kBAAkB,GAAG,CAAC;IACtB,KAAAC,WAAW,GAAG,CAAC;IACf,KAAAC,SAAS,GAAG,CAAC;IAEb;IACA,KAAAC,cAAc,GAAG,KAAK;IACtB,KAAAC,YAAY,GAAG,KAAK;IACpB,KAAAC,SAAS,GAAG;MACVC,EAAE,EAAE,EAAE;MACNC,OAAO,EAAE,EAAE;MACXC,IAAI,EAAE;KACP;EAKE;EAEHC,QAAQA,CAAA;IACN,IAAI,CAACC,iBAAiB,EAAE;IACxB,IAAI,CAACC,aAAa,EAAE;EACtB;EAEAD,iBAAiBA,CAAA;IACf,IAAI,CAAClB,OAAO,GAAG,IAAI;IACnB,MAAMoB,MAAM,GAAG,OAAO,CAAC,CAAC;IAExB,IAAI,CAACvB,mBAAmB,CAACwB,gBAAgB,CAACD,MAAM,EAAE;MAChDE,UAAU,EAAE,IAAI,CAACjB,UAAU,KAAK,QAAQ;MACxCkB,IAAI,EAAE,IAAI,CAACtB,WAAW;MACtBuB,KAAK,EAAE,CAAC,IAAI,CAACtB;KACd,CAAC,CAACuB,SAAS,CAAC;MACXC,IAAI,EAAGC,QAAQ,IAAI;QACjB,IAAI,CAAC7B,aAAa,GAAG,IAAI,CAACO,UAAU,KAAK,MAAM,GAC3CsB,QAAQ,CAACC,IAAI,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,MAAM,CAAC,GACnCJ,QAAQ,CAACC,IAAI;QACjB,IAAI,CAACzB,UAAU,GAAGwB,QAAQ,CAACK,UAAU,CAACC,KAAK;QAC3C,IAAI,CAAC7B,UAAU,GAAGuB,QAAQ,CAACK,UAAU,CAAC5B,UAAU;QAChD,IAAI,CAACI,kBAAkB,GAAGmB,QAAQ,CAACK,UAAU,CAACC,KAAK;QACnD,IAAI,CAACxB,WAAW,GAAGkB,QAAQ,CAACC,IAAI,CAACC,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,MAAM,CAAC,CAACG,MAAM;QAC9D,IAAI,CAACxB,SAAS,GAAGiB,QAAQ,CAACC,IAAI,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,MAAM,CAAC,CAACG,MAAM;QAC3D,IAAI,CAAClC,OAAO,GAAG,KAAK;MACtB,CAAC;MACDmC,KAAK,EAAGC,GAAG,IAAI;QACbC,OAAO,CAACF,KAAK,CAAC,+BAA+B,EAAEC,GAAG,CAAC;QACnD,IAAI,CAACpC,OAAO,GAAG,KAAK;MACtB;KACD,CAAC;EACJ;EAEAmB,aAAaA,CAAA;IACX;IACA;IACA,IAAI,CAACpB,SAAS,GAAG,EAAE;EACrB;EAEAuC,UAAUA,CAACC,EAAU;IACnB,IAAI,CAAC1C,mBAAmB,CAACyC,UAAU,CAACC,EAAE,CAAC,CAACd,SAAS,CAAC;MAChDC,IAAI,EAAEA,CAAA,KAAK;QACT,IAAI,CAACR,iBAAiB,EAAE;MAC1B,CAAC;MACDiB,KAAK,EAAGC,GAAG,IAAI;QACbC,OAAO,CAACF,KAAK,CAAC,sCAAsC,EAAEC,GAAG,CAAC;QAC1DI,KAAK,CAAC,qCAAqC,CAAC;MAC9C;KACD,CAAC;EACJ;EAEAC,aAAaA,CAAA;IACX,MAAMC,mBAAmB,GAAG,IAAI,CAAC5C,aAAa,CAAC+B,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,MAAM,CAAC;IACrE,IAAIW,mBAAmB,CAACR,MAAM,KAAK,CAAC,EAAE;IAEtCS,OAAO,CAACC,GAAG,CAACF,mBAAmB,CAACG,GAAG,CAACf,CAAC,IACnC,IAAI,CAACjC,mBAAmB,CAACyC,UAAU,CAACR,CAAC,CAACS,EAAE,CAAC,CAACO,SAAS,EAAE,CACtD,CAAC,CAACC,IAAI,CAAC,MAAK;MACX,IAAI,CAAC7B,iBAAiB,EAAE;IAC1B,CAAC,CAAC,CAAC8B,KAAK,CAAEZ,GAAG,IAAI;MACfC,OAAO,CAACF,KAAK,CAAC,2CAA2C,EAAEC,GAAG,CAAC;MAC/DI,KAAK,CAAC,0CAA0C,CAAC;IACnD,CAAC,CAAC;EACJ;EAEAS,WAAWA,CAACC,YAA0B;IACpC,IAAI,CAAC5C,oBAAoB,GAAG4C,YAAY;EAC1C;EAEAC,cAAcA,CAAA;IACZ,IAAI,CAACxC,cAAc,GAAG,IAAI;IAC1B,IAAI,CAACE,SAAS,GAAG;MAAEC,EAAE,EAAE,EAAE;MAAEC,OAAO,EAAE,EAAE;MAAEC,IAAI,EAAE;IAAE,CAAE;EACpD;EAEAoC,eAAeA,CAAA;IACb,IAAI,CAACzC,cAAc,GAAG,KAAK;EAC7B;EAEA0C,SAASA,CAAA;IACP,IAAI,CAACzC,YAAY,GAAG,IAAI;IACxB,IAAI,CAACf,mBAAmB,CAACwD,SAAS,CAAC;MACjCvC,EAAE,EAAE,IAAI,CAACD,SAAS,CAACC,EAAE;MACrBC,OAAO,EAAE,IAAI,CAACF,SAAS,CAACE,OAAO;MAC/BC,IAAI,EAAE,IAAI,CAACH,SAAS,CAACG;KACtB,CAAC,CAACS,SAAS,CAAC;MACXC,IAAI,EAAEA,CAAA,KAAK;QACT,IAAI,CAACd,YAAY,GAAG,KAAK;QACzB,IAAI,CAACwC,eAAe,EAAE;QACtBZ,KAAK,CAAC,0BAA0B,CAAC;QACjC,IAAI,CAACrB,aAAa,EAAE;MACtB,CAAC;MACDgB,KAAK,EAAGC,GAAG,IAAI;QACbC,OAAO,CAACF,KAAK,CAAC,uBAAuB,EAAEC,GAAG,CAAC;QAC3C,IAAI,CAACxB,YAAY,GAAG,KAAK;QACzB4B,KAAK,CAAC,sBAAsB,CAAC;MAC/B;KACD,CAAC;EACJ;EAEAc,QAAQA,CAAC/B,IAAY;IACnB,IAAIA,IAAI,GAAG,CAAC,IAAIA,IAAI,GAAG,IAAI,CAACnB,UAAU,EAAE;IACxC,IAAI,CAACH,WAAW,GAAGsB,IAAI;IACvB,IAAI,CAACL,iBAAiB,EAAE;EAC1B;EAEAqC,cAAcA,CAAA;IACZ,MAAMC,KAAK,GAAa,EAAE;IAC1B,MAAMC,KAAK,GAAGlD,IAAI,CAACmD,GAAG,CAAC,CAAC,EAAE,IAAI,CAACzD,WAAW,GAAG,CAAC,CAAC;IAC/C,MAAM0D,GAAG,GAAGpD,IAAI,CAACqD,GAAG,CAAC,IAAI,CAACxD,UAAU,EAAE,IAAI,CAACH,WAAW,GAAG,CAAC,CAAC;IAC3D,KAAK,IAAI4D,CAAC,GAAGJ,KAAK,EAAEI,CAAC,IAAIF,GAAG,EAAEE,CAAC,EAAE,EAAE;MACjCL,KAAK,CAACM,IAAI,CAACD,CAAC,CAAC;;IAEf,OAAOL,KAAK;EACd;EAEAO,YAAYA,CAACC,IAAY;IACvB,QAAQA,IAAI;MACV,KAAK,OAAO;QAAE,OAAO,2BAA2B;MAChD,KAAK,KAAK;QAAE,OAAO,6BAA6B;MAChD,KAAK,MAAM;QAAE,OAAO,+BAA+B;MACnD;QAAS,OAAO,2BAA2B;;EAE/C;EAEAC,mBAAmBA,CAACC,MAAc;IAChC,QAAQA,MAAM;MACZ,KAAK,MAAM;QAAE,OAAO,6BAA6B;MACjD,KAAK,QAAQ;QAAE,OAAO,yBAAyB;MAC/C,KAAK,SAAS;QAAE,OAAO,+BAA+B;MACtD;QAAS,OAAO,2BAA2B;;EAE/C;EAEAC,MAAMA,CAAA;IACJ,IAAI,CAACvE,eAAe,CAACuE,MAAM,EAAE;EAC/B;;;uBArKWzE,sBAAsB,EAAA0E,EAAA,CAAAC,iBAAA,CAAAC,EAAA,CAAAC,eAAA,GAAAH,EAAA,CAAAC,iBAAA,CAAAG,EAAA,CAAAC,mBAAA;IAAA;EAAA;;;YAAtB/E,sBAAsB;MAAAgF,SAAA;MAAAC,KAAA;MAAAC,IAAA;MAAAC,QAAA,WAAAC,gCAAAC,EAAA,EAAAC,GAAA;QAAA,IAAAD,EAAA;UAHtBX,EAAA,CAAAa,MAAA,oBAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}