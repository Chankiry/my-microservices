<nav class="navbar">
<div class="container" style="display: flex; justify-content: space-between; align-items: center;">
    <a class="navbar-brand" routerLink="/">Admin Dashboard</a>
    <div class="navbar-nav">
    <a class="nav-link" routerLink="/">Home</a>
    <a class="nav-link" routerLink="/dashboard">Dashboard</a>
    <a class="nav-link" routerLink="/users">Users</a>
    <a class="nav-link" routerLink="/orders">Orders</a>
    <a class="nav-link" routerLink="/payments">Payments</a>
    <a class="nav-link" routerLink="/notifications">Notifications</a>
    <button class="btn btn-danger" style="margin-left: 10px;" (click)="logout()">Logout</button>
    </div>
</div>
</nav>

<div class="container" style="padding-top: 30px;">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1>Notification Management</h1>
    <div style="display: flex; gap: 10px;">
    <button class="btn btn-primary" (click)="openEmailModal()">Send Email</button>
    <button class="btn btn-secondary" (click)="loadNotifications()">Refresh</button>
    </div>
</div>

<!-- Stats -->
<div class="grid" style="margin-bottom: 20px;">
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Total Notifications</p>
    <p style="font-size: 32px; font-weight: bold; color: #007bff;">{{ totalNotifications }}</p>
    </div>
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Unread</p>
    <p style="font-size: 32px; font-weight: bold; color: #dc3545;">{{ unreadCount }}</p>
    </div>
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Read</p>
    <p style="font-size: 32px; font-weight: bold; color: #28a745;">{{ readCount }}</p>
    </div>
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Emails Sent</p>
    <p style="font-size: 32px; font-weight: bold; color: #6f42c1;">{{ emailLogs.length }}</p>
    </div>
</div>

<!-- Filters -->
<div class="card" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center; justify-content: space-between;">
    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
        <div>
        <label style="display: block; margin-bottom: 5px; color: #666;">Filter</label>
        <select [(ngModel)]="filterType" (change)="loadNotifications()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="all">All Notifications</option>
            <option value="unread">Unread Only</option>
            <option value="read">Read Only</option>
        </select>
        </div>
        <div>
        <label style="display: block; margin-bottom: 5px; color: #666;">Items per page</label>
        <select [(ngModel)]="pageSize" (change)="loadNotifications()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
        </select>
        </div>
    </div>
    <button *ngIf="unreadCount > 0" (click)="markAllAsRead()" class="btn btn-success">
        Mark All as Read
    </button>
    </div>
</div>

<!-- Notifications List -->
<div class="card">
    <div *ngIf="loading" style="text-align: center; padding: 40px;">
    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 15px; color: #666;">Loading notifications...</p>
    </div>

    <div *ngIf="!loading && notifications.length === 0" style="text-align: center; padding: 40px; color: #666;">
    <svg style="width: 64px; height: 64px; margin-bottom: 15px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
    </svg>
    <h3>No notifications found</h3>
    <p>There are no notifications in the system yet.</p>
    </div>

    <div *ngIf="!loading && notifications.length > 0">
    <div *ngFor="let notification of notifications" 
        [style.background]="notification.isRead ? 'white' : '#e3f2fd'"
        style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start;">
        <div style="flex: 1;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
            <span [ngClass]="getTypeClass(notification.type)" 
                style="padding: 2px 8px; border-radius: 12px; font-size: 11px; text-transform: uppercase; font-weight: 600;">
            {{ notification.type }}
            </span>
            <span *ngIf="!notification.isRead" 
                style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">
            New
            </span>
            <span style="color: #999; font-size: 12px;">{{ notification.createdAt | date:'short' }}</span>
        </div>
        <h4 style="margin: 5px 0; font-size: 16px;">{{ notification.title }}</h4>
        <p style="color: #666; margin: 5px 0; font-size: 14px;">{{ notification.message }}</p>
        <p *ngIf="notification.link" style="font-size: 12px; margin: 5px 0;">
            <a [href]="notification.link" target="_blank" style="color: #007bff;">View Details â†’</a>
        </p>
        </div>
        <div style="display: flex; gap: 5px;">
        <button *ngIf="!notification.isRead" 
                (click)="markAsRead(notification.id)" 
                style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">
            Mark Read
        </button>
        <button (click)="viewDetails(notification)" 
                style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">
            Details
        </button>
        </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
        <p style="color: #666;">Showing {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalItems) }} of {{ totalItems }} notifications</p>
        <div style="display: flex; gap: 5px;">
        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1" 
                style="padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;"
                [style.opacity]="currentPage === 1 ? '0.5' : '1'">
            Previous
        </button>
        <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)" 
                style="padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;"
                [style.background]="page === currentPage ? '#007bff' : 'white'"
                [style.color]="page === currentPage ? 'white' : 'inherit'">
            {{ page }}
        </button>
        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages" 
                style="padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;"
                [style.opacity]="currentPage === totalPages ? '0.5' : '1'">
            Next
        </button>
        </div>
    </div>
    </div>
</div>

<!-- Email Logs Section -->
<div class="card" style="margin-top: 30px;" *ngIf="emailLogs.length > 0">
    <h3 style="margin-bottom: 20px;">Recent Email Activity</h3>
    <table style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="border-bottom: 2px solid #ddd;">
        <th style="text-align: left; padding: 12px;">To</th>
        <th style="text-align: left; padding: 12px;">Subject</th>
        <th style="text-align: left; padding: 12px;">Status</th>
        <th style="text-align: left; padding: 12px;">Sent At</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let email of emailLogs" style="border-bottom: 1px solid #eee;">
        <td style="padding: 12px;">{{ email.to }}</td>
        <td style="padding: 12px;">{{ email.subject }}</td>
        <td style="padding: 12px;">
            <span [ngClass]="getEmailStatusClass(email.status)" 
                style="padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500;">
            {{ email.status }}
            </span>
        </td>
        <td style="padding: 12px;">{{ email.sentAt | date:'short' }}</td>
        </tr>
    </tbody>
    </table>
</div>
</div>

<!-- Send Email Modal -->
<div *ngIf="showEmailModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;" (click)="closeEmailModal()">
<div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;" (click)="$event.stopPropagation()">
    <h2 style="margin-bottom: 20px;">Send Email</h2>
    <form (ngSubmit)="sendEmail()">
    <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; color: #666;">To Email</label>
        <input type="email" [(ngModel)]="emailForm.to" name="to" required 
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;"
            placeholder="recipient@example.com">
    </div>
    <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; color: #666;">Subject</label>
        <input type="text" [(ngModel)]="emailForm.subject" name="subject" required 
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;"
            placeholder="Email subject">
    </div>
    <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 5px; color: #666;">Message</label>
        <textarea [(ngModel)]="emailForm.body" name="body" required rows="5"
                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; resize: vertical;"
                placeholder="Enter your message..."></textarea>
    </div>
    <div style="display: flex; justify-content: flex-end; gap: 10px;">
        <button type="button" (click)="closeEmailModal()" 
                style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Cancel
        </button>
        <button type="submit" [disabled]="sendingEmail"
                style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;"
                [style.opacity]="sendingEmail ? '0.7' : '1'">
        {{ sendingEmail ? 'Sending...' : 'Send Email' }}
        </button>
    </div>
    </form>
</div>
</div>

<!-- Notification Details Modal -->
<div *ngIf="selectedNotification" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;" (click)="selectedNotification = null">
<div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;" (click)="$event.stopPropagation()">
    <h2 style="margin-bottom: 20px;">Notification Details</h2>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Notification ID</p>
    <p style="font-family: monospace; font-size: 14px;">{{ selectedNotification.id }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Type</p>
    <span [ngClass]="getTypeClass(selectedNotification.type)" 
            style="padding: 4px 12px; border-radius: 12px; font-size: 14px; text-transform: uppercase; font-weight: 600;">
        {{ selectedNotification.type }}
    </span>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Title</p>
    <p style="font-size: 18px; font-weight: 500;">{{ selectedNotification.title }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Message</p>
    <p style="line-height: 1.6;">{{ selectedNotification.message }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Status</p>
    <span [style.color]="selectedNotification.isRead ? '#28a745' : '#dc3545'" style="font-weight: 500;">
        {{ selectedNotification.isRead ? 'Read' : 'Unread' }}
    </span>
    </div>
    <div *ngIf="selectedNotification.readAt" style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Read At</p>
    <p>{{ selectedNotification.readAt | date:'medium' }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Created At</p>
    <p>{{ selectedNotification.createdAt | date:'medium' }}</p>
    </div>
    <div *ngIf="selectedNotification.data" style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Additional Data</p>
    <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto;">{{ selectedNotification.data | json }}</pre>
    </div>
    <div style="text-align: right;">
    <button (click)="selectedNotification = null" 
            style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Close
    </button>
    </div>
</div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>