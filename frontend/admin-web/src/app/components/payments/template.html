<nav class="navbar">
<div class="container" style="display: flex; justify-content: space-between; align-items: center;">
    <a class="navbar-brand" routerLink="/">Admin Dashboard</a>
    <div class="navbar-nav">
    <a class="nav-link" routerLink="/">Home</a>
    <a class="nav-link" routerLink="/dashboard">Dashboard</a>
    <a class="nav-link" routerLink="/users">Users</a>
    <a class="nav-link" routerLink="/orders">Orders</a>
    <a class="nav-link" routerLink="/payments">Payments</a>
    <a class="nav-link" routerLink="/notifications">Notifications</a>
    <button class="btn btn-danger" style="margin-left: 10px;" (click)="logout()">Logout</button>
    </div>
</div>
</nav>

<div class="container" style="padding-top: 30px;">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1>Payment Management</h1>
    <button class="btn btn-primary" (click)="loadPayments()">Refresh</button>
</div>

<!-- Stats -->
<div class="grid" style="margin-bottom: 20px;">
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Total Payments</p>
    <p style="font-size: 32px; font-weight: bold; color: #007bff;">{{ totalPayments }}</p>
    </div>
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Completed</p>
    <p style="font-size: 32px; font-weight: bold; color: #28a745;">{{ completedPayments }}</p>
    </div>
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Pending</p>
    <p style="font-size: 32px; font-weight: bold; color: #ffc107;">{{ pendingPayments }}</p>
    </div>
    <div class="card" style="text-align: center;">
    <p style="color: #666; margin-bottom: 5px;">Failed</p>
    <p style="font-size: 32px; font-weight: bold; color: #dc3545;">{{ failedPayments }}</p>
    </div>
</div>

<!-- Filters -->
<div class="card" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
    <div>
        <label style="display: block; margin-bottom: 5px; color: #666;">Status Filter</label>
        <select [(ngModel)]="statusFilter" (change)="loadPayments()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="">All Statuses</option>
        <option value="completed">Completed</option>
        <option value="pending">Pending</option>
        <option value="processing">Processing</option>
        <option value="failed">Failed</option>
        <option value="refunded">Refunded</option>
        </select>
    </div>
    <div>
        <label style="display: block; margin-bottom: 5px; color: #666;">Items per page</label>
        <select [(ngModel)]="pageSize" (change)="loadPayments()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        </select>
    </div>
    </div>
</div>

<!-- Payments Table -->
<div class="card">
    <div *ngIf="loading" style="text-align: center; padding: 40px;">
    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 15px; color: #666;">Loading payments...</p>
    </div>

    <div *ngIf="!loading && payments.length === 0" style="text-align: center; padding: 40px; color: #666;">
    <svg style="width: 64px; height: 64px; margin-bottom: 15px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <h3>No payments found</h3>
    <p>There are no payments in the system yet.</p>
    </div>

    <table *ngIf="!loading && payments.length > 0" style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="border-bottom: 2px solid #ddd;">
        <th style="text-align: left; padding: 12px;">Payment ID</th>
        <th style="text-align: left; padding: 12px;">Order ID</th>
        <th style="text-align: left; padding: 12px;">Date</th>
        <th style="text-align: left; padding: 12px;">Method</th>
        <th style="text-align: left; padding: 12px;">Status</th>
        <th style="text-align: right; padding: 12px;">Amount</th>
        <th style="text-align: center; padding: 12px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let payment of payments" style="border-bottom: 1px solid #eee;">
        <td style="padding: 12px; font-family: monospace; font-size: 12px;">{{ payment.id | slice:0:8 }}...</td>
        <td style="padding: 12px; font-family: monospace; font-size: 12px;">{{ payment.orderId | slice:0:8 }}...</td>
        <td style="padding: 12px;">{{ payment.createdAt | date:'short' }}</td>
        <td style="padding: 12px; text-transform: capitalize;">{{ payment.paymentMethod }}</td>
        <td style="padding: 12px;">
            <span [ngClass]="getStatusClass(payment.status)" style="padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500;">
            {{ payment.status }}
            </span>
        </td>
        <td style="padding: 12px; text-align: right; font-weight: 500;">{{ payment.currency }} {{ payment.amount }}</td>
        <td style="padding: 12px; text-align: center;">
            <button (click)="viewDetails(payment)" style="margin-right: 5px; padding: 4px 8px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px;">
            Details
            </button>
            <button *ngIf="payment.status === 'completed'" (click)="refundPayment(payment.id)" style="padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 12px;">
            Refund
            </button>
        </td>
        </tr>
    </tbody>
    </table>

    <!-- Pagination -->
    <div *ngIf="!loading && totalPages > 1" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
    <p style="color: #666;">Showing {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalItems) }} of {{ totalItems }} payments</p>
    <div style="display: flex; gap: 5px;">
        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1" style="padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" [style.opacity]="currentPage === 1 ? '0.5' : '1'">
        Previous
        </button>
        <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)" style="padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;" [style.background]="page === currentPage ? '#007bff' : 'white'" [style.color]="page === currentPage ? 'white' : 'inherit'">
        {{ page }}
        </button>
        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages" style="padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" [style.opacity]="currentPage === totalPages ? '0.5' : '1'">
        Next
        </button>
    </div>
    </div>
</div>
</div>

<!-- Payment Details Modal -->
<div *ngIf="selectedPayment" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;" (click)="selectedPayment = null">
<div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;" (click)="$event.stopPropagation()">
    <h2 style="margin-bottom: 20px;">Payment Details</h2>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Payment ID</p>
    <p style="font-family: monospace; font-size: 14px;">{{ selectedPayment.id }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Order ID</p>
    <p style="font-family: monospace; font-size: 14px;">{{ selectedPayment.orderId }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Amount</p>
    <p style="font-size: 24px; font-weight: bold;">{{ selectedPayment.currency }} {{ selectedPayment.amount }}</p>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Status</p>
    <span [ngClass]="getStatusClass(selectedPayment.status)" style="padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: 500;">
        {{ selectedPayment.status }}
    </span>
    </div>
    <div style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Payment Method</p>
    <p style="text-transform: capitalize;">{{ selectedPayment.paymentMethod }}</p>
    </div>
    <div *ngIf="selectedPayment.transactions?.length" style="margin-bottom: 15px;">
    <p style="color: #666; margin-bottom: 5px;">Transactions</p>
    <div style="border: 1px solid #eee; border-radius: 4px; padding: 10px;">
        <div *ngFor="let tx of selectedPayment.transactions" style="padding: 8px; border-bottom: 1px solid #eee;">
        <div style="display: flex; justify-content: space-between;">
            <span style="text-transform: capitalize;">{{ tx.type }}</span>
            <span [ngClass]="tx.status === 'success' ? 'text-green-600' : 'text-red-600'">{{ tx.status }}</span>
        </div>
        <p style="font-size: 12px; color: #666;">{{ tx.currency }} {{ tx.amount }}</p>
        </div>
    </div>
    </div>
    <div style="text-align: right;">
    <button (click)="selectedPayment = null" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Close</button>
    </div>
</div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>